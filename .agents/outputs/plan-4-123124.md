# Implementation Plan
**Generated**: 2024-12-31 22:15 PST
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #4 - Analytics: Install Google Analytics 4 and Google Tag Manager
**Estimated Build Time**: 2-3 hours
**Complexity**: Moderate

## Investigation Summary

### Request Analysis
**Type**: Feature (Analytics Infrastructure)
**Source**: GitHub Issue #4
**Priority**: Critical (per issue labels)

### Task Classification
**Category**: FEATURE
**Test Strategy**: STANDARD (Build + lint + visual verification)

### Current State Assessment
- **Existing Analytics**: Vercel Analytics installed in `src/main.jsx` (line 4, 16)
- **Index.html**: Standard structure, no GTM/GA4 scripts present (69 lines)
- **Form submission**: Contact form in `src/App.jsx` (lines 238-270) - key conversion point
- **Click-to-call**: Footer phone link at line 817 (`tel:+15036190505`)
- **Email clicks**: Footer email link at line 815 (`mailto:hello@aireadypdx.com`)
- **SPA Routing**: React Router with BrowserRouter in `src/main.jsx`
- **Build status**: Passing (verified)
- **Lint status**: Passing (verified)

### Complexity Assessment
**Complexity**: Moderate
**Effort**: 2-3 hours
**Risk**: Low - Standard GTM/GA4 integration with placeholder IDs

### Key Implementation Considerations
1. **GTM installation requires two script tags**: One in `<head>`, one in `<body>`
2. **SPA page tracking**: GTM dataLayer push for React Router navigation
3. **Form conversion tracking**: Push to dataLayer on successful form submission
4. **Click tracking**: CSS selectors for tel: and mailto: links
5. **Placeholder IDs**: User must create GTM container and GA4 property externally

### Patterns Identified
**Primary**: Vercel Analytics import pattern in `src/main.jsx`
**Reference**: Lines 4, 16 show how external analytics are imported and placed in component tree
**Form Pattern**: `handleSubmit` function at line 238 shows where to inject dataLayer push

---

## Executive Summary

This plan implements Google Tag Manager (GTM) and Google Analytics 4 (GA4) infrastructure for the AI Ready PDX website. GTM will be added to `index.html` with placeholder container ID. A dataLayer utility module will be created for React-friendly event tracking. Form submission, click-to-call, and email click events will be configured to push to the dataLayer. The user must externally create GTM container and GA4 property, then update the placeholder IDs.

---

## Phase 1: GTM Infrastructure Setup

### Subtask 1.1: Add GTM Scripts to index.html
**File**: `/home/pbrown/aireadypdx/index.html`
**Pattern**: Standard GTM installation per Google documentation
**Instructions**:
1. Add GTM `<head>` script immediately after opening `<head>` tag (after line 2)
2. Add GTM `<noscript>` fallback immediately after opening `<body>` tag (after line 65)
3. Use placeholder ID `GTM-XXXXXXX` with clear comment for user to replace

**Code to add in `<head>` (after line 2)**:
```html
<!-- Google Tag Manager - Replace GTM-XXXXXXX with your container ID -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-XXXXXXX');</script>
<!-- End Google Tag Manager -->
```

**Code to add in `<body>` (after line 65)**:
```html
<!-- Google Tag Manager (noscript) - Replace GTM-XXXXXXX with your container ID -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
```

**Validation**:
```bash
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] GTM head script present in index.html
- [ ] GTM noscript fallback present in index.html
- [ ] Placeholder ID `GTM-XXXXXXX` clearly marked with comment
- [ ] Build passes
- [ ] HTML structure remains valid

---

### Subtask 1.2: Create DataLayer Utility Module
**File**: `/home/pbrown/aireadypdx/src/utils/analytics.js` (new file)
**Pattern**: Utility module for centralized tracking
**Instructions**:
1. Create `src/utils/` directory if it doesn't exist
2. Create `analytics.js` with dataLayer push helper functions
3. Include functions for: page views, form submissions, click events

**Code for new file**:
```javascript
/**
 * Analytics utility functions for Google Tag Manager dataLayer
 *
 * SETUP REQUIRED:
 * 1. Create GTM container at https://tagmanager.google.com
 * 2. Replace GTM-XXXXXXX in index.html with your container ID
 * 3. Create GA4 property at https://analytics.google.com
 * 4. Add GA4 Configuration tag in GTM with your Measurement ID (G-XXXXXXX)
 */

// Ensure dataLayer exists
const getDataLayer = () => {
  if (typeof window !== 'undefined') {
    window.dataLayer = window.dataLayer || [];
    return window.dataLayer;
  }
  return [];
};

/**
 * Track page view (for SPA navigation)
 * @param {string} pagePath - The page path (e.g., '/', '/about')
 * @param {string} pageTitle - The page title
 */
export const trackPageView = (pagePath, pageTitle) => {
  getDataLayer().push({
    event: 'page_view',
    page_path: pagePath,
    page_title: pageTitle
  });
};

/**
 * Track form submission
 * @param {string} formName - Name of the form (e.g., 'contact_form')
 * @param {boolean} requestedSession - Whether user requested AI Readiness Session
 */
export const trackFormSubmission = (formName, requestedSession = false) => {
  getDataLayer().push({
    event: 'form_submission',
    form_name: formName,
    requested_ai_session: requestedSession
  });
};

/**
 * Track click-to-call
 * @param {string} phoneNumber - The phone number clicked
 */
export const trackPhoneClick = (phoneNumber) => {
  getDataLayer().push({
    event: 'phone_click',
    phone_number: phoneNumber
  });
};

/**
 * Track email click
 * @param {string} emailAddress - The email address clicked
 */
export const trackEmailClick = (emailAddress) => {
  getDataLayer().push({
    event: 'email_click',
    email_address: emailAddress
  });
};

/**
 * Track CTA button click
 * @param {string} ctaName - Name/identifier of the CTA
 * @param {string} ctaLocation - Location on page (e.g., 'hero', 'pricing')
 */
export const trackCtaClick = (ctaName, ctaLocation) => {
  getDataLayer().push({
    event: 'cta_click',
    cta_name: ctaName,
    cta_location: ctaLocation
  });
};
```

**Validation**:
```bash
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] `src/utils/analytics.js` file created
- [ ] All 5 tracking functions exported
- [ ] Setup instructions included in comments
- [ ] Build passes
- [ ] Lint passes

---

## Phase 2: Event Tracking Integration

### Subtask 2.1: Add Form Submission Tracking
**File**: `/home/pbrown/aireadypdx/src/App.jsx`
**Pattern**: Add dataLayer push in existing handleSubmit success path
**Instructions**:
1. Import `trackFormSubmission` from analytics utility (add at top of file)
2. In `handleSubmit` function, add tracking call after successful response (line ~253, inside `if (response.ok)` block)

**Import to add at top (after line 4)**:
```javascript
import { trackFormSubmission, trackPhoneClick, trackEmailClick } from './utils/analytics'
```

**Code to add inside `if (response.ok)` block (after line 253, before setFormData reset)**:
```javascript
        // Track form submission for analytics
        trackFormSubmission('contact_form', formData.freeSession)
```

**Validation**:
```bash
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] Import statement added
- [ ] trackFormSubmission called on successful form submission
- [ ] freeSession value passed for session request tracking
- [ ] Build passes
- [ ] Lint passes

---

### Subtask 2.2: Add Click Tracking for Phone and Email
**File**: `/home/pbrown/aireadypdx/src/App.jsx`
**Pattern**: Add onClick handlers to existing footer links
**Instructions**:
1. Modify email link (line 815) to include onClick handler
2. Modify phone link (line 817) to include onClick handler

**Current code (line 815)**:
```jsx
<p><a href="mailto:hello@aireadypdx.com">hello@aireadypdx.com</a></p>
```

**Replace with**:
```jsx
<p><a href="mailto:hello@aireadypdx.com" onClick={() => trackEmailClick('hello@aireadypdx.com')}>hello@aireadypdx.com</a></p>
```

**Current code (line 817)**:
```jsx
<p><a href="tel:+15036190505">(503) 619-0505</a></p>
```

**Replace with**:
```jsx
<p><a href="tel:+15036190505" onClick={() => trackPhoneClick('+15036190505')}>(503) 619-0505</a></p>
```

**Validation**:
```bash
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] Email link has onClick tracking
- [ ] Phone link has onClick tracking
- [ ] Links still function normally (href preserved)
- [ ] Build passes
- [ ] Lint passes

---

## Phase 3: Documentation

### Subtask 3.1: Create GTM/GA4 Setup Instructions
**File**: `/home/pbrown/aireadypdx/docs/ANALYTICS_SETUP.md` (new file)
**Pattern**: Step-by-step external setup guide
**Instructions**:
1. Create `docs/` directory if it doesn't exist
2. Create comprehensive setup guide with:
   - GTM container creation steps
   - GA4 property creation steps
   - How to replace placeholder IDs
   - GTM tag configuration for GA4
   - Conversion event setup in GA4
   - Google Ads integration steps

**Content for new file**:
```markdown
# Analytics Setup Guide

This guide covers setting up Google Tag Manager (GTM) and Google Analytics 4 (GA4) for AI Ready PDX.

## Prerequisites

- Google account with access to Google Tag Manager and Google Analytics
- Admin access to update the codebase (to replace placeholder IDs)

## Step 1: Create Google Tag Manager Container

1. Go to [Google Tag Manager](https://tagmanager.google.com)
2. Click "Create Account"
3. Enter account name: "AI Ready PDX"
4. Enter container name: "aireadypdx.com"
5. Select "Web" as target platform
6. Accept Terms of Service
7. **Copy your Container ID** (format: GTM-XXXXXXX)

### Update the Code

1. Open `/index.html`
2. Find both instances of `GTM-XXXXXXX`
3. Replace with your actual Container ID

## Step 2: Create Google Analytics 4 Property

1. Go to [Google Analytics](https://analytics.google.com)
2. Click Admin (gear icon)
3. Click "Create Property"
4. Enter property name: "AI Ready PDX"
5. Select business details and objectives
6. Create a Web data stream for `aireadypdx.com`
7. **Copy your Measurement ID** (format: G-XXXXXXXXXX)

## Step 3: Connect GA4 to GTM

1. In GTM, go to Tags > New
2. Click Tag Configuration > Google Analytics: GA4 Configuration
3. Enter your Measurement ID (G-XXXXXXXXXX)
4. Set Trigger to "All Pages"
5. Name the tag "GA4 Configuration"
6. Save

## Step 4: Set Up Conversion Events

### Form Submission Tracking

1. In GTM, create a new Trigger:
   - Trigger Type: Custom Event
   - Event Name: `form_submission`
   - Name: "Form Submission Event"

2. Create a new Tag:
   - Tag Type: Google Analytics: GA4 Event
   - Configuration Tag: Select your GA4 Configuration
   - Event Name: `generate_lead`
   - Add Parameters:
     - `form_name`: {{DLV - form_name}}
     - `requested_ai_session`: {{DLV - requested_ai_session}}
   - Trigger: Form Submission Event
   - Name: "GA4 - Form Submission"

3. Create Data Layer Variables for parameters:
   - Variable Type: Data Layer Variable
   - Name: DLV - form_name, Data Layer Variable Name: form_name
   - Name: DLV - requested_ai_session, Data Layer Variable Name: requested_ai_session

### Phone Click Tracking

1. Create Trigger:
   - Trigger Type: Custom Event
   - Event Name: `phone_click`

2. Create Tag:
   - Tag Type: GA4 Event
   - Event Name: `phone_click`
   - Parameter: `phone_number` = {{DLV - phone_number}}

### Email Click Tracking

1. Create Trigger:
   - Trigger Type: Custom Event
   - Event Name: `email_click`

2. Create Tag:
   - Tag Type: GA4 Event
   - Event Name: `email_click`
   - Parameter: `email_address` = {{DLV - email_address}}

## Step 5: Mark Conversions in GA4

1. In GA4, go to Admin > Events
2. Find your events (form_submission, phone_click, email_click)
3. Toggle "Mark as conversion" for each

## Step 6: Google Ads Integration

### Link Google Ads to GA4

1. In GA4, go to Admin > Product Links > Google Ads Links
2. Click "Link"
3. Select your Google Ads account
4. Enable personalized advertising
5. Complete linking

### Import Conversions to Google Ads

1. In Google Ads, go to Tools > Conversions
2. Click "+ New conversion action"
3. Select "Import" > Google Analytics 4
4. Select your GA4 property
5. Choose conversions to import (form_submission, phone_click)

### Set Up Remarketing

1. In GTM, the GA4 Configuration tag automatically enables remarketing
2. In Google Ads, create remarketing audiences from GA4 data

## Step 7: Test and Publish

1. In GTM, click "Preview" to enter debug mode
2. Visit aireadypdx.com in preview mode
3. Verify all tags fire correctly:
   - GA4 Configuration on page load
   - Form submission tag when form is submitted
   - Phone/email click tags when links are clicked
4. Check GA4 Realtime reports to confirm data is flowing
5. In GTM, click "Submit" to publish changes

## Verification Checklist

- [ ] GTM container ID updated in index.html (2 places)
- [ ] GA4 Configuration tag created in GTM
- [ ] Form submission tracking working
- [ ] Phone click tracking working
- [ ] Email click tracking working
- [ ] GA4 receiving data (check Realtime reports)
- [ ] Conversions marked in GA4
- [ ] Google Ads linked (if applicable)
- [ ] GTM published to production

## Troubleshooting

### Tags Not Firing

1. Check browser console for JavaScript errors
2. Verify GTM container ID is correct
3. Use GTM Preview mode to debug

### No Data in GA4

1. Verify Measurement ID is correct
2. Check GA4 Realtime report (data appears within seconds)
3. Verify GTM container is published (not just previewed)

### Form Submission Not Tracking

1. Verify the form submission succeeds (API returns 200)
2. Check dataLayer in browser console after submission
3. Verify trigger event name matches exactly: `form_submission`
```

**Validation**:
```bash
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] `docs/ANALYTICS_SETUP.md` file created
- [ ] All setup steps documented
- [ ] GTM configuration instructions included
- [ ] Google Ads integration steps included
- [ ] Verification checklist included

---

## Summary of Deliverables

**Files Modified**:
- `/home/pbrown/aireadypdx/index.html` - GTM scripts with placeholder ID
- `/home/pbrown/aireadypdx/src/App.jsx` - Analytics imports and event tracking

**Files Created**:
- `/home/pbrown/aireadypdx/src/utils/analytics.js` - DataLayer utility functions
- `/home/pbrown/aireadypdx/docs/ANALYTICS_SETUP.md` - External setup documentation

**User Action Required After Implementation**:
1. Create GTM container at tagmanager.google.com
2. Create GA4 property at analytics.google.com
3. Replace `GTM-XXXXXXX` in index.html with actual container ID
4. Follow ANALYTICS_SETUP.md to configure GTM tags
5. Publish GTM container

---

## Handoff to Build Agent

1. Execute subtasks in exact order (1.1 -> 1.2 -> 2.1 -> 2.2 -> 3.1)
2. Test completion criteria before next subtask
3. Create `src/utils/` directory before creating analytics.js
4. Create `docs/` directory before creating ANALYTICS_SETUP.md
5. Run `npm run dev` for visual verification that site still loads
6. Verify dataLayer exists in browser console after implementation

---

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Issue Classification | 1m |
| Investigation | 8m |
| Pattern Identification | 3m |
| Validation | 2m |
| Planning | 10m |
| **Total** | **24m** |

---

## Insights & Process Improvements (REQUIRED)

### Issues Encountered During Investigation
1. **External service dependency** - GTM and GA4 require account creation outside the codebase. Resolved by using placeholder IDs and creating comprehensive setup documentation.
2. **SPA considerations** - React Router is used but only for 2 routes (main page and novus-migration-status). For initial implementation, GTM's built-in history change tracking should suffice without custom page view tracking on navigation.

### Input Quality Assessment
**Clarity of Original Request**: 4/5
**Missing Information**:
- Specific Google Ads account information (not needed for code implementation)
- Whether specific CTA buttons should be tracked beyond form/phone/email
**Suggested Input Improvements**:
- Include any existing Google account/property IDs if available
- Specify priority conversions for Google Ads optimization

### Process Improvement Suggestions
**For Future Scout-and-Plan Runs**:
1. For analytics implementations, always verify current analytics stack first (Vercel Analytics found here)
2. Check for SPA routing to determine if custom page view tracking is needed

**For Build Agent**:
1. Create directories (`src/utils/`, `docs/`) before creating files in them
2. Verify dataLayer exists in browser console after implementing GTM scripts
3. Test form submission manually to confirm tracking fires

**For Overall Workflow**:
1. Analytics issues should include a step for the user to provide their GTM/GA4 IDs after code is deployed
2. Consider creating a follow-up issue for verifying analytics is working in production
