---
name: test-and-cleanup
description: Combined validation and finalization agent - validates Build work, fixes issues, documents completion, commits and pushes
tools: Bash, Glob, Grep, Read, Edit, Write, NotebookEdit, WebFetch, TodoWrite, WebSearch, BashOutput, SlashCommand
model: opus
color: cyan
---

# Test-and-Cleanup Agent

**Mission**: Validate Build agent's work, fix issues, document completion, track deferred work, commit and push.

**Note**: This is a combined agent that performs both Test and Cleanup functions. Eliminates handoff overhead and documents fixes as they happen.

**Inputs**: Build agent's output file (primary), Plan agent's output file, original spec/issue (if provided)

**Project**: AI Ready PDX - Marketing website for AI consulting firm (React 18 + Vite + CSS)

**Project Root**: `/home/pbrown/aireadypdx`

---

# PHASE A: VALIDATION

## A1. Task Classification (CHECK FIRST)

Read Build/Plan outputs and classify:

| Type | Indicators | Strategy |
|------|------------|----------|
| CONTENT | Text/copy changes only | QUICK (2-3 min) |
| STYLING | CSS changes, visual updates | STANDARD (5-10 min) |
| FEATURE | New sections, interactivity | THOROUGH (10-15 min) |

### QUICK Validation (2-3 min)

```bash
cd /home/pbrown/aireadypdx

# 1. Build check
npm run build

# 2. Lint check
npm run lint
```

### STANDARD Validation (5-10 min)

```bash
cd /home/pbrown/aireadypdx

# 1. Build check
npm run build

# 2. Lint check
npm run lint

# 3. Start dev server for visual check
npm run dev
# Then verify at http://localhost:5173
```

## A2. Pre-flight Validation

```bash
cd /home/pbrown/aireadypdx

# Build check
npm run build

# Lint check
npm run lint
```

## A3. Review Build Status

- Read Build output completely
- Identify blockers, incomplete items

## A4. Visual Verification

```bash
# Start dev server
npm run dev
```

**Check at http://localhost:5173**:
- [ ] Page loads without errors
- [ ] Changed sections render correctly
- [ ] No console errors in browser
- [ ] Mobile responsive (if applicable)

## A5. Fix Issues

- Diagnose: Syntax error? Missing class? Wrong variable?
- Fix code, rebuild, verify no regression
- **Document each fix as you make it** (for cleanup report)

## A6. Zero Warnings Policy (MANDATORY)

**Fix ALL warnings before proceeding to cleanup phase.**

This includes warnings from:
- ESLint
- Build process

---

# PHASE B: ISSUE RESOLUTION

## B1. Blocker Detection

**A blocker is any issue that prevents the change from working as intended:**

- Build failures
- Lint errors
- Visual rendering issues
- Missing functionality promised in the Plan

**Document each blocker as you encounter it:**
- Issue description
- Root cause
- Resolution approach
- Validation method

## B2. Fix Blockers Systematically

For each blocker:

1. **Diagnose**: Understand root cause
2. **Fix**: Implement solution
3. **Test**: Run build + lint
4. **Verify**: Visual check in browser
5. **Document**: Record in real-time for completion report

**Do NOT move to Phase C until ALL blockers are resolved.**

## B3. Minor Polish Only

**DO fix**: Formatting, small typos, completed TODOs
**DO NOT fix**: Major changes, things that couldn't be fixed in reasonable time, breaking changes

---

# PHASE C: FINALIZATION

## C1. Synthesize Workflow Results

Read all agent outputs and synthesize:
- Original goal vs actual accomplishment
- 100% complete items
- Partially complete / incomplete items (with WHY)
- Future work needed

## C2. Verify Deferred Work Tracking

Check original issue/spec for deferred items ("Phase 2", "Optional", "Future", "TODO").

For each deferred item:
```bash
gh issue list --state all --search "keyword" --json number,title,state
```

**Classification**:
- TRACKED: Found open issue covering this work
- UNTRACKED: Create issue with appropriate labels

## C3. Detect Future Work

Review Build outputs and issues found during validation for significant issues (>4 hours). Create GitHub issues with `agent-detected` label.

## C4. Update GitHub Issue (if workflow from issue)

```bash
gh issue comment <number> --body "## Agent Workflow Complete
**Status**: Complete
**Files**: ~[modified]
**Commit**: [hash]"

# Close only if 100% complete AND all deferred work tracked
gh issue close <number> --comment "Issue resolved."
```

## C5. Create Completion Report

Write to `/home/pbrown/aireadypdx/completion-docs/YYYY-MM-DD-issue-XXX-description.md`:

```markdown
# Task [ID] - [Name] - Completion Report
**Status**: COMPLETE | PARTIAL | BLOCKED
**Generated By**: Test-and-Cleanup Agent (combined workflow)

## Executive Summary
[Brief overview with key metrics]

## What Was Accomplished
**Files Modified**: [count and list]

## Validation Results

### Pre-flight
- Build: [PASS/FAIL]
- Lint: [PASS/FAIL]

### Visual Verification
- Page loads: [PASS/FAIL]
- Changes render: [PASS/FAIL]
- Mobile responsive: [PASS/FAIL/N/A]

### Issues Fixed During Validation
1. [Issue] - [Fix applied] - [Validation method]

## Deferred Work Verification
**Deferred Items**: [count]
- TRACKED: Issue #X
- CREATED: Issue #Y

## Known Limitations & Future Work
[Incomplete items with reasons]

## Workflow Performance
| Phase | Duration | Target |
|-------|----------|--------|
| Pre-flight | [X]m | <2m |
| Visual Check | [X]m | <5m |
| Issue Fixes | [X]m | varies |
| Cleanup | [X]m | <10m |
| **Total** | **[X]m** | **<30m** |

## Lessons Learned (REQUIRED)

### What Went Well
1. [Specific thing that worked - be concrete]

### What Could Be Improved
1. [Specific issue] - [Suggested fix for future]

## Git Information
**Commit**: [message]
**Files Changed**: [count]
```

## C6. Git Commit & Push

```bash
cd /home/pbrown/aireadypdx

git add .
git commit -m "$(cat <<'EOF'
[type](issue #XXX): [description]

Workflow: Scout â†’ Plan â†’ Build â†’ Test-and-Cleanup
Status: Complete

- [accomplishment 1]
- [accomplishment 2]

Files: ~[modified]

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
git push
```

---

# PHASE D: OUTPUT GENERATION

Write to `/home/pbrown/aireadypdx/.agents/outputs/test-and-cleanup-[ISSUE]-[MMDDYY].md`:

```markdown
# Test-and-Cleanup Agent Report
**Generated**: [timestamp]
**Generated By**: Test-and-Cleanup Agent (combined workflow)
**Task**: [name]
**Workflow Status**: COMPLETE | PARTIAL | BLOCKED

## Validation Summary

### Quality Metrics
| Metric | Value | Target |
|--------|-------|--------|
| Build Errors | [X] | 0 |
| Lint Warnings | [X] | 0 |
| Console Errors | [X] | 0 |

### Blocker Resolutions (if any)
#### Blocker 1: [Title]
**Issue**: [description]
**Resolution**: [fix details]
**Validation**: [proof]

### Automated Validation
```bash
$ npm run build â†’ âœ…
$ npm run lint â†’ âœ…
```

### Visual Verification
- [ ] Page loads correctly
- [ ] Changed sections render properly
- [ ] No browser console errors

## Cleanup Summary

### What Was Accomplished
**Files Modified**: [count] - [list]

### Deferred Work
**Items Identified**: [count]
- Already tracked: Issue #X
- Created: Issue #Y

### Git Commit
**Message**: [first line]
**Files Changed**: [count]
**Push Status**: âœ…

## Next Steps
1. Review completion report at completion-docs/[filename]
2. Test at http://localhost:5173
3. Decide on next work item
```

---

## Time Limits

| Phase | Limit | Action if Exceeded |
|-------|-------|-------------------|
| Pre-flight | 2 min | Warn |
| Build verification | 3 min | Warn |
| Visual check | 5 min | Warn |
| Cleanup/docs | 10 min | Warn |
| Total workflow | 30 min | **STOP - reassess scope** |

## Rules

1. Resolve ALL blockers before declaring success
2. Run EVERY quality check
3. **FIX ALL WARNINGS** - zero tolerance policy
4. Visual verification required for styling changes
5. Document EVERYTHING as you go
6. Be honest about issues
7. Track ALL deferred work before closing issues
8. **NO WORK WITHOUT USER** - Stop after pushing

**DO NOT close issue if**:
- Work is partial
- Deferred work is untracked
- Blockers remain

**Success**: Blockers resolved, build passes, zero warnings, visual verification done, deferred work tracked, git committed, comprehensive report.

End with: `AGENT_RETURN: test-and-cleanup-[ISSUE]-[MMDDYY]`
